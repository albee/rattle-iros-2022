"""
# FAM_constants.py

Supporting constants for FAM calculations. Derived from the Astrobee Simulink model.

"""
import numpy as np

# Nozzle physical properties
nozzle_height = 0.0131
nozzle_flap_length = 0.0136
nozzle_widths_i = np.array([0.1270, 0.1270, 0.0711, 0.0711, 0.0711, 0.0711])
nozzle_widths = np.hstack([nozzle_widths_i, nozzle_widths_i])

# opening limits
nozzle_min_angle = 0.2736676
nozzle_max_angle = 1.394692659
# The nozzle angles are mapped from 0 to 255, how many radians is each step?
step_in_rad = (nozzle_max_angle - nozzle_min_angle) / 255
# nozzle orientations
nozzle_orientations =  np.array([[1,      0,     0],
                                 [-1,     0,     0],
                                 [0,      1,     0],
                                 [0,      1,     0],
                                 [0,      0,     1],
                                 [0,      0,    -1],
                                 [-1,    0,     0],
                                 [1,      0,     0],
                                 [0,     -1,     0],
                                 [0,     -1,     0],
                                 [0,      0,     1],
                                 [0,      0,    -1]])
# position of nozzle - center of gravity
P_nozzle_B_B = np.array([[ 0.1524,    0.1019,  -0.0396],
                         [-0.1524,    0.1019,   0.0396],
                         [0.0719,     0.1524,    0.0719],
                         [-0.0719,    0.1524,   -0.0719],
                         [-0.0676,    0.1019,    0.1524],
                         [0.0676,     0.1019,   -0.1524],
                         [-0.1524,   -0.1019,   -0.0396],
                         [0.1524,    -0.1019,    0.0396],
                         [-0.0719,   -0.1524,    0.0719],
                         [0.0719,    -0.1524,   -0.0719],
                         [ 0.0676,   -0.1019,    0.1524],
                         [-0.0676,   -0.1019,   -0.1524]])

air_density = 1.200

# Impeller properties
impeller_diameter = 0.1397
impeller_speed = 261.7994       #impeller speed based on flight mode, Consider flight mode was 2 (nominal), N = 261.7994

# Discharge coefficients
Cd_PM1 = np.array([0.9150, 0.7558, 0.9408, 0.7921, 0.9240, 0.9303])
Cd_PM2 = np.array([0.9471, 0.7645, 1, 0.9048, 0.9366, 0.8938])
Cd = np.hstack([Cd_PM1, Cd_PM2])

# # It looks like FAM always uses Center of mass offset as zero?
# CoM = np.array([ 0, 0, 0]).reshape(1,3)
# CoM = CoM.repeat(12, axis=0)

# Lookup table converting from thrust to Cdp
thrust_breakpoints = np.array([3.8366e-08, 1.2244e-07, 2.0623e-07, 2.8974e-07, 3.7294e-07, 4.5584e-07, 5.3841e-07,
                               6.2065e-07, 7.0253e-07, 7.8406e-07, 8.6521e-07, 9.4597e-07, 1.0263e-06, 1.1063e-06,
                               1.1858e-06, 1.2648e-06, 1.3434e-06, 1.4216e-06, 1.4992e-06, 1.5764e-06, 1.6530e-06,
                               1.7290e-06, 1.8046e-06, 1.8795e-06, 1.9539e-06, 2.0276e-06, 2.1007e-06, 2.1732e-06,
                               2.2450e-06, 2.3162e-06, 2.3866e-06, 2.4563e-06, 2.5253e-06, 2.5935e-06, 2.6609e-06,
                               2.7275e-06, 2.7933e-06, 2.8583e-06, 2.9223e-06, 2.9855e-06, 3.0477e-06, 3.1090e-06,
                               3.1694e-06, 3.2287e-06, 3.2870e-06, 3.3443e-06, 3.4004e-06, 3.4555e-06, 3.5094e-06,
                               3.5622e-06, 3.6137e-06, 3.6641e-06, 3.7131e-06, 3.7609e-06, 3.8073e-06, 3.8524e-06,
                               3.8960e-06, 3.9383e-06, 3.9790e-06, 4.0182e-06, 4.0558e-06, 4.0919e-06, 4.1263e-06,
                               4.1590e-06, 4.1899e-06, 4.2190e-06, 4.2463e-06, 4.2717e-06, 4.2952e-06, 4.3166e-06,
                               4.3359e-06, 4.3531e-06, 4.3680e-06, 4.3807e-06, 4.3911e-06, 4.3989e-06, 4.4043e-06,
                               4.4070e-06, 4.4071e-06])

Cdp_values = np.array([0.049311, 0.048921, 0.048529, 0.048134, 0.047738, 0.047339, 0.046938, 0.046534,
                  0.046129, 0.045721, 0.045311, 0.044899, 0.044484, 0.044068, 0.04365,  0.043229,
                  0.042806, 0.042382, 0.041955, 0.041527, 0.041096, 0.040664, 0.040229, 0.039793,
                  0.039355, 0.038915, 0.038474, 0.03803,  0.037585, 0.037138, 0.03669,  0.03624,
                  0.035788, 0.035335, 0.03488,  0.034423, 0.033966, 0.033506, 0.033046, 0.032584,
                  0.032121, 0.031656, 0.031191, 0.030724, 0.030256, 0.029787, 0.029317, 0.028846,
                  0.028374, 0.027901, 0.027427, 0.026953, 0.026477, 0.026001, 0.025525, 0.025048,
                  0.02457,  0.024092, 0.023613, 0.023134, 0.022655, 0.022176, 0.021696, 0.021216,
                  0.020736, 0.020257, 0.019777, 0.019297, 0.018818, 0.018339, 0.01786,  0.017382,
                  0.016904, 0.016427, 0.01595,  0.015475, 0.015,    0.014525, 0.014052])

Delta_P = np.array([79.1508179, 78.5249863, 77.8954773, 77.2623138, 76.6255035, 75.9850998, 75.3410873, 74.6935425, 74.0424652, 73.3878708, 72.7297821, 72.0682678, 71.4033203, 70.7350082, 70.0633240, 69.3883514, 68.7100525,
68.0285492, 67.3438034, 66.6559296, 65.9649048, 65.2707443, 64.5735779, 63.8733978, 63.1702805, 62.4641914, 61.7552681, 61.0435600, 60.3290329, 59.6117859, 58.8918610, 58.1693611, 57.4442558, 56.7166595,
55.9865990, 55.2541885, 54.5194054, 53.7823524, 53.0431290, 52.3017273, 51.5582390, 50.8127403, 50.0653343, 49.3160286, 48.5649071, 47.8120346, 47.0575066, 46.3013992, 45.5438232, 44.7847824, 44.0243645,
43.2627144, 42.4998665, 41.7358589, 40.9708862, 40.2049599, 39.4382172, 38.6706924, 37.9025230, 37.1337929, 36.3645363, 35.5949326, 34.8250427, 34.0550079, 33.2848511, 32.5147629, 31.7447720, 30.9749832,
30.2056351, 29.4366131, 28.6682472, 27.9005146, 27.1336308, 26.3676128, 25.6026554, 24.8388100, 24.0762444, 23.3151131, 22.5553837])

thrust_breakpoints_modified = np.array([0.0026296, 0.0083916, 0.0141349, 0.0198583, 0.0255612, 0.0312428, 0.0369023, 0.0425386, 0.0481508, 0.0537384, 0.0593003, 0.0648355, 0.0703432, 0.0758222, 0.0812720, 0.0866909, 0.0920786,
0.0974335, 0.1027549, 0.1080415, 0.1132924, 0.1185065, 0.1236823, 0.1288190, 0.1339152, 0.1389699, 0.1439818, 0.1489492, 0.1538715, 0.1587471, 0.1635745, 0.1683524, 0.1730797, 0.1777546,
0.1823758, 0.1869417, 0.1914509, 0.1959019, 0.2002928, 0.2046224, 0.2088886, 0.2130902, 0.2172248, 0.2212912, 0.2252874, 0.2292114, 0.2330616, 0.2368356, 0.2405315, 0.2441474, 0.2476811,
0.2511304, 0.2544931, 0.2577668, 0.2609493, 0.2640379, 0.2670301, 0.2699236, 0.2727155, 0.2754028, 0.2779832, 0.2804533, 0.2828102, 0.2850506, 0.2871713, 0.2891687, 0.2910393, 0.2927797,
 0.2943856, 0.2958530, 0.2971777, 0.2983555, 0.2993814, 0.3002507, 0.3009582, 0.3014983, 0.3018652, 0.3020532, 0.3020551])

thrust_modified_div_by_delta_P = np.array([0.0000332, 0.0001069, 0.0001815, 0.0002570, 0.0003336, 0.0004112, 0.0004898, 0.0005695, 0.0006503, 0.0007323, 0.0008154, 0.0008996, 0.0009852, 0.0010719, 0.0011600, 0.0012494, 0.0013401,
0.0014322, 0.0015258, 0.0016209, 0.0017175, 0.0018156, 0.0019154, 0.0020168, 0.0021199, 0.0022248, 0.0023315, 0.0024400, 0.0025505, 0.0026630, 0.0027775, 0.0028942, 0.0030130, 0.0031341,
0.0032575, 0.0033833, 0.0035116, 0.0036425, 0.0037760, 0.0039123, 0.0040515, 0.0041936, 0.0043388, 0.0044872, 0.0046389, 0.0047940, 0.0049527, 0.0051151, 0.0052813, 0.0054516, 0.0056260,
0.0058048, 0.0059881, 0.0061761, 0.0063691, 0.0065673, 0.0067708, 0.0069801, 0.0071952, 0.0074165, 0.0076444, 0.0078790, 0.0081209, 0.0083703, 0.0086277, 0.0088935, 0.0091681, 0.0094521,
0.0097460, 0.0100505, 0.0103661, 0.0106935, 0.0110336, 0.0113871, 0.0117550, 0.0121382, 0.0125379, 0.0129553, 0.0133917])